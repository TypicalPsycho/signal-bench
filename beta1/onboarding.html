<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SignalBench beta | Onboarding</title>
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon/favicon-16x16.png" />
  <link rel="apple-touch-icon" href="icons/favicon/apple-touch-icon.png" />
  <link rel="manifest" href="icons/favicon/site.webmanifest" />
  <link rel="stylesheet" href="ui_shell.css" />
  <script src="ui_theme.js"></script>
  <script src="ui_store.js"></script>
</head>
<body>
  <!--
    Integration Notes (Onboarding)
    - Create U01 from name/email/resume + consent
    - Save preferences: career level (up to 2), employment status, tone, length
    - Route to /casefile/new
  -->
  <div class="wrap">
    <div class="page">
                  <header class="page-header">
        <div class="brand large">
          <div class="brand-menu">
            <button class="brand-logo" type="button" aria-label="Open navigation">
              <img src="icons/logo1_round_80.png" alt="SignalBench logo" />
            </button>
            <div class="brand-panel" role="menu">

          <a href="landing.html" role="menuitem">Landing</a>
          <a href="auth.html" role="menuitem">Auth</a>
          <a href="onboarding.html" role="menuitem">Onboarding</a>
          <a href="casefile_new.html" role="menuitem">Casefile Setup</a>
          <a href="app.html" role="menuitem">App</a>
          <a href="settings.html" role="menuitem">Settings</a>
          <a href="feedback.html" role="menuitem">Feedback</a>
            </div>
          </div>
          <span class="brand-name">SignalBench</span>
        </div>
      </header>

      <main class="page-body">
        <section class="card">
          <h1 class="title">Create your Candidate Profile</h1>
          <p class="subtitle">
            SignalBench builds a candidate profile anchored in your resume, then strengthens it over time as the
            system learns who you are, what you’ve done, and where you’re headed next in your career.
            <br /><br />
            To begin, upload your base resume by attaching the file or pasting the text below. You’ll also be asked
            a few brief questions to give the system helpful context about your goals and direction.
          </p>
        </section>

        <section class="card">
          <h2 class="title" style="font-size:22px;">Profile name and image</h2>
          <div class="row" style="margin-bottom:10px;">
            <label class="field" style="flex:1">
              <span>Full name</span>
              <input type="text" placeholder="Full name" required />
            </label>
            <label class="field" style="flex:1">
              <span>How should we address you</span>
              <input type="text" placeholder="Preferred name" required />
            </label>
            <label class="field" style="flex:1">
              <span>Email</span>
              <input type="email" placeholder="you@email.com" required />
            </label>
          </div>
          <div class="row" style="align-items:center; gap:12px; justify-content:flex-start;">
            <label class="field" style="max-width:360px;">
              <span>Profile image (optional)</span>
              <input id="profileImage" type="file" accept="image/*" />
            </label>
            <div class="avatar" id="profilePreview" aria-label="Profile image preview"></div>
          </div>
        </section>

        <section class="card">
          <h2 class="title" style="font-size:22px;">Resume upload</h2>
          <label class="field">
            <span>Upload resume (PDF/DOCX/TXT)</span>
            <input type="file" />
          </label>
          <div class="note" style="margin:8px 0;">OR</div>
          <label class="field">
            <span>Paste resume text</span>
            <textarea placeholder="Paste resume text here"></textarea>
          </label>

          <label class="field" style="margin-top:14px;">
            <div class="note">
              <strong>Privacy note:</strong> Avoid including sensitive personal information such as social security numbers,
              tax ID numbers, phone numbers, or home addresses. SignalBench does not need this information to work effectively,
              and excluding it helps keep your data safe.
            </div>
            <label style="display:flex; gap:8px; align-items:center; margin-top:8px;">
              <input type="checkbox" id="consentBox" />
              <span>I understand and will avoid sharing sensitive personal information that SignalBench does not require.</span>
            </label>
          </label>
        </section>

        <section class="card">
          <h2 class="title" style="font-size:22px;">Career context</h2>
          <p class="subtitle">These settings help SignalBench tailor guidance to your level, situation, and preferences. You can change them anytime.</p>

          <div class="field" style="margin-top:10px;">
            <span>Career level sought for next role</span>
            <div class="note">Select up to two.</div>
            <div class="row" style="flex-direction:column; margin-top:6px;">
              <label class="pill"><input type="checkbox" name="level" value="ic" /> Individual contributor</label>
              <label class="pill"><input type="checkbox" name="level" value="mgr" /> Manager (people manager)</label>
              <label class="pill"><input type="checkbox" name="level" value="dir" /> Director (manages managers)</label>
              <label class="pill"><input type="checkbox" name="level" value="vp" /> VP / General Manager</label>
              <label class="pill"><input type="checkbox" name="level" value="cxo" /> C‑suite / President</label>
              <label class="pill"><input type="checkbox" name="level" value="na" /> Not sure</label>
            </div>
          </div>

          <div class="field" style="margin-top:12px;">
            <span>Current employment status</span>
            <div class="note">Select one.</div>
            <div class="row" style="flex-direction:column; margin-top:6px;">
              <label class="pill"><input type="radio" name="status" value="ft_adv" /> Employed, exploring internal or external opportunities</label>
              <label class="pill"><input type="radio" name="status" value="pt_contract" /> Contract or part‑time, seeking full‑time</label>
              <label class="pill"><input type="radio" name="status" value="transition_ft" /> In transition, seeking full‑time only</label>
              <label class="pill"><input type="radio" name="status" value="transition_any" /> In transition, open to full‑time, part‑time, or contract</label>
              <label class="pill"><input type="radio" name="status" value="na" /> Prefer not to say</label>
            </div>
          </div>

        </section>

        <section class="card">
          <h2 class="title" style="font-size:22px;">Response preferences</h2>
          <div class="row">
            <label class="field" style="flex:1">
              <span>Tone</span>
              <input type="range" id="toneSlider" min="0" max="10" value="5" style="width:100%;" />
              <div class="note">Softened and eloquent ←→ Blunt and direct</div>
              <div class="note"><small>The system remains direct and truthful either way.</small></div>
            </label>
            <label class="field" style="flex:1">
              <span>Length</span>
              <input type="range" id="lengthSlider" min="0" max="10" value="5" style="width:100%;" />
              <div class="note">Brief ←→ Detailed</div>
              <div class="note"><small>Choose how concise you want responses to be.</small></div>
            </label>
          </div>
        </section>

        <section class="card">
          <div class="row">
            <button class="btn primary" id="btnCreateProfile" type="button" disabled>
              Create my profile and continue
            </button>
          </div>
        </section>
      </main>
    </div>
  </div>

  <script>
    const consentBox = document.getElementById("consentBox");
    const btn = document.getElementById("btnCreateProfile");
    const toneSlider = document.getElementById("toneSlider");
    const lengthSlider = document.getElementById("lengthSlider");
    const levelChecks = Array.from(document.querySelectorAll("input[name='level']"));
    const statusRadios = Array.from(document.querySelectorAll("input[name='status']"));
    const resumeFile = document.querySelector("input[type='file']");
    const resumeText = document.querySelector("textarea");
    const fullName = document.querySelector("input[placeholder='Full name']");
    const emailInput = document.querySelector("input[type='email']");
    const profileImage = document.getElementById("profileImage");
    const profilePreview = document.getElementById("profilePreview");

    if (profilePreview){
      profilePreview.style.width = "56px";
      profilePreview.style.height = "56px";
      profilePreview.style.borderRadius = "50%";
      profilePreview.style.border = "1px solid var(--line)";
      profilePreview.style.background = "var(--panel)";
      profilePreview.style.overflow = "hidden";
      profilePreview.style.display = "grid";
      profilePreview.style.placeItems = "center";
      profilePreview.innerHTML = '<svg width="28" height="28" viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21a8 8 0 0 0-16 0"></path><circle cx="12" cy="8" r="4"></circle></svg>';
      profilePreview.style.color = "var(--muted)";
    }

    if (profileImage){
      profileImage.addEventListener("change", (e) => {
        const file = e.target.files && e.target.files[0];
        if (!file || !profilePreview) return;
        const reader = new FileReader();
        reader.onload = () => {
          profilePreview.innerHTML = "";
          profilePreview.style.backgroundImage = `url(${reader.result})`;
          profilePreview.style.backgroundSize = "cover";
          profilePreview.style.backgroundPosition = "center";
        };
        reader.readAsDataURL(file);
      });
    }

    const enforceLevelLimit = () => {
      const checked = levelChecks.filter((c) => c.checked);
      if (checked.length >= 2){
        levelChecks.filter((c) => !c.checked).forEach((c) => c.disabled = true);
      } else {
        levelChecks.forEach((c) => c.disabled = false);
      }
    };

    const isResumeProvided = () => {
      return (resumeFile && resumeFile.files && resumeFile.files.length > 0) || (resumeText && resumeText.value.trim().length > 0);
    };

    const updateState = () => {
      enforceLevelLimit();
      const levelCount = levelChecks.filter((c) => c.checked).length;
      const statusSelected = statusRadios.some((r) => r.checked);
      const ok = consentBox.checked
        && isResumeProvided()
        && fullName.value.trim().length > 0
        && emailInput.value.trim().length > 0
        && levelCount > 0
        && statusSelected
        && toneSlider.value !== ""
        && lengthSlider.value !== "";
      btn.disabled = !ok;
    };

    levelChecks.forEach((c) => c.addEventListener("change", updateState));
    statusRadios.forEach((r) => r.addEventListener("change", updateState));
    consentBox.addEventListener("change", updateState);
    toneSlider.addEventListener("input", updateState);
    lengthSlider.addEventListener("input", updateState);
    resumeFile.addEventListener("change", updateState);
    resumeText.addEventListener("input", updateState);
    fullName.addEventListener("input", updateState);
    emailInput.addEventListener("input", updateState);

    btn.addEventListener("click", () => {
      const store = UIStore.load();
      store.auth = { ...(store.auth || {}), isAuthed: true };
      store.me = { id: store.me?.id || (crypto.randomUUID ? crypto.randomUUID() : String(Date.now())), email: emailInput.value.trim() };
      store.u01 = {
        fullName: fullName.value.trim(),
        nickname: "",
        email: emailInput.value.trim(),
        resumeText: resumeText.value.trim(),
        consent: consentBox.checked,
        createdAt: new Date().toISOString()
      };
      store.preferences = {
        tone: toneSlider.value,
        length: lengthSlider.value,
        careerLevel: levelChecks.filter((c) => c.checked).map((c) => c.value),
        employmentStatus: statusRadios.find((r) => r.checked)?.value || ""
      };
      UIStore.save(store);
      window.location.href = "casefile_new.html";
    });
  </script>


  <script>
    document.querySelectorAll(".brand-menu").forEach((menu) => {
      const trigger = menu.querySelector(".brand-logo");
      if (!trigger) return;
      trigger.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        menu.classList.toggle("open");
      });
    });
    document.addEventListener("click", (e) => {
      document.querySelectorAll(".brand-menu.open").forEach((menu) => {
        if (!menu.contains(e.target)) menu.classList.remove("open");
      });
    });
  </script>
</body>
</html>

